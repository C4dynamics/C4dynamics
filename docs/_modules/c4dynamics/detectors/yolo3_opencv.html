
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>c4dynamics.detectors.yolo3_opencv &#8212; C4DYNAMICS v2.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/style.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=d94dc4f2"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/c4dynamics/detectors/yolo3_opencv';</script>
    <link rel="icon" href="../../../_static/c4dlogo.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Mar 13, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">C4DYNAMICS v2.0</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Home
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../programs/index.html">User Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../programs/dof6sim.html">6 Degrees Of Freedom Missile Guidance Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../programs/ballistic_coefficient.html">Ballistic Coefficient Estimation using Extended Kalman Filter</a></li>


<li class="toctree-l2"><a class="reference internal" href="../../../programs/car_tracker.html">Kalman Tracking with Object Detection Models</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/States.html">State Objects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/states.state.html">The state class</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.X.html">c4dynamics.states.state.state.X</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.X0.html">c4dynamics.states.state.state.X0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.norm.html">c4dynamics.states.state.state.norm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.normalize.html">c4dynamics.states.state.state.normalize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.position.html">c4dynamics.states.state.state.position</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.velocity.html">c4dynamics.states.state.state.velocity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.addvars.html">c4dynamics.states.state.state.addvars</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.P.html">c4dynamics.states.state.state.P</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.V.html">c4dynamics.states.state.state.V</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.store.html">c4dynamics.states.state.state.store</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.storeparams.html">c4dynamics.states.state.state.storeparams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.data.html">c4dynamics.states.state.state.data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.timestate.html">c4dynamics.states.state.state.timestate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/state/c4dynamics.states.state.state.plot.html">c4dynamics.states.state.state.plot</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/states.lib.html">States library</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/states.lib.datapoint.html">Datapoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/states.lib.rigidbody.html">Rigidbody</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/states.lib.pixelpoint.html">Pixelpoint</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/Sensors.html">Sensors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/sensors.seeker.html">Seeker</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/seeker/c4dynamics.sensors.seeker.seeker.bias.html">c4dynamics.sensors.seeker.seeker.bias</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/seeker/c4dynamics.sensors.seeker.seeker.scale_factor.html">c4dynamics.sensors.seeker.seeker.scale_factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/seeker/c4dynamics.sensors.seeker.seeker.measure.html">c4dynamics.sensors.seeker.seeker.measure</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/sensors.radar.html">Radar</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/radar/c4dynamics.sensors.radar.radar.bias.html">c4dynamics.sensors.radar.radar.bias</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/radar/c4dynamics.sensors.radar.radar.scale_factor.html">c4dynamics.sensors.radar.radar.scale_factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/radar/c4dynamics.sensors.radar.radar.measure.html">c4dynamics.sensors.radar.radar.measure</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/Detectors.html">Detectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/detectors.yolov3.html">YOLOv3</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.nms_th.html">c4dynamics.detectors.yolo3_opencv.yolov3.nms_th</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.confidence_th.html">c4dynamics.detectors.yolo3_opencv.yolov3.confidence_th</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.detect.html">c4dynamics.detectors.yolo3_opencv.yolov3.detect</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/Filters.html">Filters</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/filters.kalman.html">Kalman filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/kalman/c4dynamics.filters.kalman.kalman.predict.html">c4dynamics.filters.kalman.kalman.predict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/kalman/c4dynamics.filters.kalman.kalman.update.html">c4dynamics.filters.kalman.kalman.update</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/kalman/c4dynamics.filters.kalman.kalman.store.html">c4dynamics.filters.kalman.kalman.store</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/filters.ekf.html">Extended Kalman filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/ekf/c4dynamics.filters.ekf.ekf.predict.html">c4dynamics.filters.ekf.ekf.predict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/ekf/c4dynamics.filters.ekf.ekf.update.html">c4dynamics.filters.ekf.ekf.update</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/ekf/c4dynamics.filters.ekf.ekf.store.html">c4dynamics.filters.ekf.ekf.store</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/filters.lpf.html">Lowpass filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/lpf/c4dynamics.filters.lowpass.lowpass.sample.html">c4dynamics.filters.lowpass.lowpass.sample</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/Routines.html">Routines</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/routines.eqm.html">Equations of motion solvers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/eqm/c4dynamics.eqm.derivs.eqm3.html">c4dynamics.eqm.derivs.eqm3</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/eqm/c4dynamics.eqm.derivs.eqm6.html">c4dynamics.eqm.derivs.eqm6</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/eqm/c4dynamics.eqm.integrate.int3.html">c4dynamics.eqm.integrate.int3</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/eqm/c4dynamics.eqm.integrate.int6.html">c4dynamics.eqm.integrate.int6</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/routines.rotmat.html">Rotation matrix operations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/rotmat/c4dynamics.rotmat.rotmat.rotx.html">c4dynamics.rotmat.rotmat.rotx</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/rotmat/c4dynamics.rotmat.rotmat.roty.html">c4dynamics.rotmat.rotmat.roty</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/rotmat/c4dynamics.rotmat.rotmat.rotz.html">c4dynamics.rotmat.rotmat.rotz</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/rotmat/c4dynamics.rotmat.rotmat.dcm321.html">c4dynamics.rotmat.rotmat.dcm321</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/rotmat/c4dynamics.rotmat.rotmat.dcm321euler.html">c4dynamics.rotmat.rotmat.dcm321euler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/rotmat/c4dynamics.rotmat.animate.animate.html">c4dynamics.rotmat.animate.animate</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/Utils.html">Utils</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/utils/c4dynamics.utils.tictoc.tic.html">c4dynamics.utils.tictoc.tic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/utils/c4dynamics.utils.tictoc.toc.html">c4dynamics.utils.tictoc.toc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/utils/c4dynamics.utils.cprint.cprint.html">c4dynamics.utils.cprint.cprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/utils/c4dynamics.utils.gen_gif.gif.html">c4dynamics.utils.gen_gif.gif</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/utils/c4dynamics.utils.plottools.plotdefaults.html">c4dynamics.utils.plottools.plotdefaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utils.math.html">Math functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/utils.const.html">Constants</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/Datasets.html">Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/datasets/c4dynamics.datasets.image.html">c4dynamics.datasets.image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/datasets/c4dynamics.datasets.video.html">c4dynamics.datasets.video</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/datasets/c4dynamics.datasets.nn_model.html">c4dynamics.datasets.nn_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/datasets/c4dynamics.datasets.d3_model.html">c4dynamics.datasets.d3_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/datasets/c4dynamics.datasets.download_all.html">c4dynamics.datasets.download_all</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/datasets/c4dynamics.datasets.clear_cache.html">c4dynamics.datasets.clear_cache</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for c4dynamics.detectors.yolo3_opencv</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c4dynamics</span><span class="w"> </span><span class="kn">import</span> <span class="n">c4d</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">c4dynamics</span><span class="w"> </span><span class="kn">import</span> <span class="n">pixelpoint</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="n">MODEL_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>


<div class="viewcode-block" id="yolov3">
<a class="viewcode-back" href="../../../api/detectors.yolov3.html#c4dynamics.detectors.yolo3_opencv.yolov3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">yolov3</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    YOLO: Real-Time Object Detection</span>


<span class="sd">    :class:`yolov3` is a YOLOv3 (You Only Look Once) object detection model. </span>
<span class="sd">    Though it is no longer the most accurate object detection algorithm, </span>
<span class="sd">    YOLOv3 is still a very good choice when you need real-time detection </span>
<span class="sd">    while maintaining excellent accuracy.</span>


<span class="sd">    </span>
<span class="sd">    YOLOv3 processes an entire image in a single forward pass, </span>
<span class="sd">    making it efficient for dynamic scenes.</span>
<span class="sd">    Its key strength lies the ability to simultaneously </span>
<span class="sd">    predict bounding box coordinates and class probabilities </span>
<span class="sd">    for multiple objects within an image. </span>


<span class="sd">    Parameters </span>
<span class="sd">    ==========</span>
<span class="sd">    weights_path : str, optional </span>
<span class="sd">        Path to the YOLOv3 weights file. Defaults None. </span>
<span class="sd">        </span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>
<span class="sd">    .filters </span>
<span class="sd">    .pixelpoint</span>



<span class="sd">    **Classes**</span>


<span class="sd">    Using YOLOv3 means </span>
<span class="sd">    object detection capability with the 80 pre-trained </span>
<span class="sd">    classes that come with the COCO dataset. </span>


<span class="sd">    The following 80 classes are available using COCO&#39;s pre-trained weights: </span>

<span class="sd">    .. admonition:: COCO dataset</span>

<span class="sd">        person, bicycle, car, motorcycle, airplane, bus, train, truck, boat, </span>
<span class="sd">        traffic light, fire hydrant, stop sign, parking meter, bench, bird, cat, </span>
<span class="sd">        dog, horse, sheep, cow, elephant, bear, zebra, giraffe, backpack, </span>
<span class="sd">        umbrella, handbag, tie, suitcase, frisbee, skis,snowboard, sports ball, </span>
<span class="sd">        kite, baseball bat, baseball glove, skateboard, surfboard, tennis racket, </span>
<span class="sd">        bottle, wine glass, cup, fork, knife, spoon, bowl, banana, apple, </span>
<span class="sd">        sandwich, orange, broccoli, carrot, hot dog, pizza, donut, cake, chair, </span>
<span class="sd">        couch, potted plant, bed, dining table, toilet, tv, laptop, mouse, remote, </span>
<span class="sd">        keyboard, cell phone, microwave, oven, toaster, sink, refrigerator, book, </span>
<span class="sd">        clock, vase, scissors, teddy bear, hair drier, toothbrush</span>



<span class="sd">    .. figure:: /_architecture/yolo-object-detection.jpg</span>

<span class="sd">    *Figure 1*:</span>
<span class="sd">    Object Detection with YOLO using COCO pre-trained classes &#39;dog&#39;, &#39;bicycle&#39;, &#39;truck&#39;.</span>
<span class="sd">    Read more at: `darknet-yolo &lt;https://pjreddie.com/darknet/yolo/&gt;`_.</span>


<span class="sd">    **Implementation (c4dynamics)**</span>

<span class="sd">    The :class:`yolov3` class abstracts the complexities of model initialization, </span>
<span class="sd">    input preprocessing, and output parsing. </span>
<span class="sd">    The :meth:`detect` method returns a </span>
<span class="sd">    :class:`pixelpoint &lt;c4dynamics.states.lib.pixelpoint.pixelpoint&gt;` </span>
<span class="sd">    for each detected object. </span>
<span class="sd">    The `pixelpoint` is a :mod:`predefined state class &lt;c4dynamics.states.lib&gt;`</span>
<span class="sd">    representing a data point in a video frame with an associated bounding box. </span>
<span class="sd">    Its methods and properties enhance the YOLOv3 output structure, </span>
<span class="sd">    providing a convenient data structure for handling tracking missions.</span>




<span class="sd">    **Installation**</span>

<span class="sd">    C4dynamics downloads </span>
<span class="sd">    the YOLOv3&#39; weights file </span>
<span class="sd">    once at first call to :class:`yolov3` and saves it to the cache. </span>
<span class="sd">    For further details see :mod:`datasets &lt;c4dynamics.datasets&gt;`.</span>
<span class="sd">    Alternatively, the user can provide a path to his </span>
<span class="sd">    own weights file using the parameter `weights_path`. </span>


<span class="sd">    **Construction**</span>

<span class="sd">    A YOLOv3 detector instance is created by making a direct call </span>
<span class="sd">    to the `yolov3` constructor: </span>

<span class="sd">    .. code:: </span>

<span class="sd">        &gt;&gt;&gt; from c4dynamics.detectors import yolov3</span>
<span class="sd">        &gt;&gt;&gt; yolo3 = yolov3()</span>
<span class="sd">        Fetched successfully</span>

<span class="sd">    </span>
<span class="sd">    Initialization of the instance does not require any mandatory parameters.</span>


<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    =======</span>

<span class="sd">    The following snippet initializes the YOLOv3 model and </span>
<span class="sd">    runs the `detect()` method on an image containing four airplanes. </span>
<span class="sd">    The example uses the `datasets` module from `c4dynamics` to fetch an image. </span>
<span class="sd">    For further details, see :mod:`c4dynamics.datasets`.</span>
<span class="sd">        </span>

<span class="sd">    Import required packages: </span>

<span class="sd">    .. code:: </span>

<span class="sd">        &gt;&gt;&gt; import cv2 </span>
<span class="sd">        &gt;&gt;&gt; import c4dynamics as c4d </span>
<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt </span>
<span class="sd">        </span>
<span class="sd">    Load YOLOv3 detector: </span>

<span class="sd">    .. code:: </span>

<span class="sd">        &gt;&gt;&gt; yolo3 = c4d.detectors.yolov3()</span>
<span class="sd">        Fetched successfully</span>
<span class="sd">    </span>
<span class="sd">    Fetch and read the image: </span>
<span class="sd">                </span>
<span class="sd">    .. code:: </span>

<span class="sd">        &gt;&gt;&gt; imagepath = c4d.datasets.image(&#39;planes&#39;)</span>
<span class="sd">        Fetched successfully</span>
<span class="sd">        &gt;&gt;&gt; img = cv2.imread(imagepath)</span>

<span class="sd">        </span>
<span class="sd">    Run YOLOv3 detector on an image: </span>

<span class="sd">    .. code:: </span>

<span class="sd">        &gt;&gt;&gt; pts = yolo3.detect(img)</span>

<span class="sd">        </span>
<span class="sd">    Now `pts` consists of </span>
<span class="sd">    :class:`pixelpoint &lt;c4dynamics.states.lib.pixelpoint.pixelpoint&gt;` </span>
<span class="sd">    instances for each object detected in the frame.    </span>
<span class="sd">    Let&#39;s use the properties and methods of the `pixelpoint` class to </span>
<span class="sd">    view the attributes of the detected objects:</span>


<span class="sd">    .. code::</span>

<span class="sd">        &gt;&gt;&gt; def ptup(n): return &#39;(&#39; + str(n[0]) + &#39;, &#39; + str(n[1]) + &#39;)&#39;</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;{:^10} | {:^10} | {:^16} | {:^16} | {:^10} | {:^14}&#39;.format(&#39;center x&#39;, &#39;center y&#39;, &#39;box top-left&#39;, &#39;box bottom-right&#39;, &#39;class&#39;, &#39;frame size&#39;)) # doctest: +IGNORE_OUTPUT</span>
<span class="sd">        &gt;&gt;&gt; for p in pts:</span>
<span class="sd">        ...   print(&#39;{:^10d} | {:^10d} | {:^16} | {:^16} | {:^10} | {:^14}&#39;.format(p.x, p.y, ptup(p.box[0]), ptup(p.box[1]), p.class_id, ptup(p.fsize)))     # doctest: +IGNORE_OUTPUT</span>
<span class="sd">        ...   cv2.rectangle(img, p.box[0], p.box[1], [0, 0, 0], 2)      # +IGNORE_OUTPUT</span>
<span class="sd">        ...   point = (int((p.box[0][0] + p.box[1][0]) / 2 - 75), p.box[1][1] + 22)     # doctest: +IGNORE_OUTPUT</span>
<span class="sd">        ...   cv2.putText(img, p.class_id, point, cv2.FONT_HERSHEY_SIMPLEX, 1, [0, 0, 0], 2)     # doctest: +IGNORE_OUTPUT</span>
<span class="sd">        center x  |  center y  |   box top-left   | box bottom-right |   class    |   frame size</span>
<span class="sd">          615     |    295     |    (562, 259)    |    (668, 331)    | aeroplane  |  (1280, 720)</span>
<span class="sd">          779     |    233     |    (720, 199)    |    (838, 267)    | aeroplane  |  (1280, 720)</span>
<span class="sd">          635     |    189     |    (578, 153)    |    (692, 225)    | aeroplane  |  (1280, 720)</span>
<span class="sd">          793     |    575     |    (742, 540)    |    (844, 610)    | aeroplane  |  (1280, 720)</span>

<span class="sd">          </span>
<span class="sd">    .. code:: </span>

<span class="sd">        &gt;&gt;&gt; plt.figure() # doctest: +IGNORE_OUTPUT </span>
<span class="sd">        &gt;&gt;&gt; plt.axis(False) # doctest: +IGNORE_OUTPUT </span>
<span class="sd">        &gt;&gt;&gt; plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB)) # doctest: +IGNORE_OUTPUT </span>

<span class="sd">    .. figure:: /_examples/yolov3/intro.png                  </span>


<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;person&#39;</span><span class="p">,</span>       <span class="s1">&#39;bicycle&#39;</span><span class="p">,</span>  <span class="s1">&#39;car&#39;</span><span class="p">,</span>      <span class="s1">&#39;motorbike&#39;</span><span class="p">,</span> <span class="s1">&#39;aeroplane&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;bus&#39;</span><span class="p">,</span>          <span class="s1">&#39;train&#39;</span><span class="p">,</span>    <span class="s1">&#39;truck&#39;</span><span class="p">,</span>    <span class="s1">&#39;boat&#39;</span><span class="p">,</span>     <span class="s1">&#39;traffic&#39;</span><span class="p">,</span>
                <span class="s1">&#39;light&#39;</span><span class="p">,</span>        <span class="s1">&#39;fire&#39;</span><span class="p">,</span>     <span class="s1">&#39;hydrant&#39;</span><span class="p">,</span>  <span class="s1">&#39;stop&#39;</span><span class="p">,</span>     <span class="s1">&#39;sign&#39;</span><span class="p">,</span>
                <span class="s1">&#39;parking&#39;</span><span class="p">,</span>      <span class="s1">&#39;meter&#39;</span><span class="p">,</span>    <span class="s1">&#39;bench&#39;</span><span class="p">,</span>    <span class="s1">&#39;bird&#39;</span><span class="p">,</span>     <span class="s1">&#39;cat&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dog&#39;</span><span class="p">,</span>          <span class="s1">&#39;horse&#39;</span><span class="p">,</span>    <span class="s1">&#39;sheep&#39;</span><span class="p">,</span>    <span class="s1">&#39;cow&#39;</span><span class="p">,</span>      <span class="s1">&#39;elephant&#39;</span><span class="p">,</span>
                <span class="s1">&#39;bear&#39;</span><span class="p">,</span>         <span class="s1">&#39;zebra&#39;</span><span class="p">,</span>    <span class="s1">&#39;giraffe&#39;</span><span class="p">,</span>  <span class="s1">&#39;backpack&#39;</span><span class="p">,</span> <span class="s1">&#39;umbrella&#39;</span><span class="p">,</span>
                <span class="s1">&#39;handbag&#39;</span><span class="p">,</span>      <span class="s1">&#39;tie&#39;</span><span class="p">,</span>      <span class="s1">&#39;suitcase&#39;</span><span class="p">,</span> <span class="s1">&#39;frisbee&#39;</span><span class="p">,</span>  <span class="s1">&#39;skis&#39;</span><span class="p">,</span>
                <span class="s1">&#39;snowboard&#39;</span><span class="p">,</span>    <span class="s1">&#39;sports&#39;</span><span class="p">,</span>   <span class="s1">&#39;ball&#39;</span><span class="p">,</span>     <span class="s1">&#39;kite&#39;</span><span class="p">,</span>     <span class="s1">&#39;baseball&#39;</span><span class="p">,</span>
                <span class="s1">&#39;bat&#39;</span><span class="p">,</span>          <span class="s1">&#39;baseball&#39;</span><span class="p">,</span> <span class="s1">&#39;glove&#39;</span><span class="p">,</span>    <span class="s1">&#39;skateboard&#39;</span><span class="p">,</span> <span class="s1">&#39;surfboard&#39;</span><span class="p">,</span>
                <span class="s1">&#39;tennis&#39;</span><span class="p">,</span>       <span class="s1">&#39;racket&#39;</span><span class="p">,</span>   <span class="s1">&#39;bottle&#39;</span><span class="p">,</span>   <span class="s1">&#39;wine&#39;</span><span class="p">,</span>     <span class="s1">&#39;glass&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cup&#39;</span><span class="p">,</span>          <span class="s1">&#39;fork&#39;</span><span class="p">,</span>     <span class="s1">&#39;knife&#39;</span><span class="p">,</span>    <span class="s1">&#39;spoon&#39;</span><span class="p">,</span>    <span class="s1">&#39;bowl&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;banana&#39;</span><span class="p">,</span>       <span class="s1">&#39;apple&#39;</span><span class="p">,</span>    <span class="s1">&#39;sandwich&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>   <span class="s1">&#39;broccoli&#39;</span><span class="p">,</span>
                <span class="s1">&#39;carrot&#39;</span><span class="p">,</span>       <span class="s1">&#39;hot&#39;</span><span class="p">,</span>      <span class="s1">&#39;dog&#39;</span><span class="p">,</span>      <span class="s1">&#39;pizza&#39;</span><span class="p">,</span>    <span class="s1">&#39;donut&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cake&#39;</span><span class="p">,</span>         <span class="s1">&#39;chair&#39;</span><span class="p">,</span>    <span class="s1">&#39;sofa&#39;</span><span class="p">,</span>     <span class="s1">&#39;pottedplant&#39;</span><span class="p">,</span> <span class="s1">&#39;bed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;diningtable&#39;</span><span class="p">,</span>  <span class="s1">&#39;toilet&#39;</span><span class="p">,</span>   <span class="s1">&#39;tvmonitor&#39;</span><span class="p">,</span> <span class="s1">&#39;laptop&#39;</span><span class="p">,</span>  <span class="s1">&#39;mouse&#39;</span><span class="p">,</span>
                <span class="s1">&#39;remote&#39;</span><span class="p">,</span>       <span class="s1">&#39;keyboard&#39;</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>     <span class="s1">&#39;phone&#39;</span><span class="p">,</span>    <span class="s1">&#39;microwave&#39;</span><span class="p">)</span>

    <span class="n">_nms_th</span> <span class="o">=</span> <span class="mf">0.5</span> 
    <span class="n">_confidence_th</span> <span class="o">=</span> <span class="mf">0.5</span> 
 
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

      <span class="n">errormsg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
      <span class="k">if</span> <span class="n">weights_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">weights_path</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">nn_model</span><span class="p">(</span><span class="s1">&#39;YOLOv3&#39;</span><span class="p">)</span>
        <span class="n">errormsg</span> <span class="o">=</span> <span class="s2">&quot;Try to clear the cache by &#39;c4dynamics.datasets.clear_cache()&#39;&quot;</span>


        
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">weights_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;yolov3.weights&#39; does not &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;exist in: &#39;</span><span class="si">{</span><span class="n">weights_path</span><span class="si">}</span><span class="s2">&#39;. </span><span class="si">{</span><span class="n">errormsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


      <span class="n">cfg_path</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">)</span>
    <span class="c1">#   cfg_path = &#39;yolov3.cfg&#39;</span>
    <span class="c1">#   coconames = os.path.join(yolodir, &#39;coco.names&#39;)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setPreferableBackend</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_BACKEND_OPENCV</span><span class="p">)</span>
      <span class="n">ln</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ln</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()]</span>

    <span class="c1">#   with open(coconames, &#39;r&#39;) as f:</span>
    <span class="c1">#     self.class_names = f.read().strip().split(&#39;\n&#39;)</span>
        
      <span class="c1"># self.__dict__.update(kwargs)</span>
        


    <span class="nd">@property</span> 
    <span class="k">def</span><span class="w"> </span><span class="nf">nms_th</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets and sets the Non-Maximum Suppression (NMS) threshold.</span>

<span class="sd">        Objects with confidence scores below this threshold are suppressed. </span>
<span class="sd">        </span>

<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nms_th : float</span>
<span class="sd">            The new threshold value for NMS during object detection. </span>
<span class="sd">            Defaults: `nms_th = 0.5`. </span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        nms_th : float</span>
<span class="sd">            The threshold value used for NMS during object detection.</span>
<span class="sd">            Objects with confidence scores below this threshold are suppressed. </span>

<span class="sd">            </span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        Import required packages:</span>
<span class="sd">        </span>
<span class="sd">        .. code:: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; import c4dynamics as c4d </span>
<span class="sd">            &gt;&gt;&gt; from matplotlib import pyplot as plt </span>
<span class="sd">            &gt;&gt;&gt; import cv2 </span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        Fetch &#39;planes.png&#39; using the c4dynamics&#39; datasets module (see :mod:`c4dynamics.datasets`):         </span>
<span class="sd">            </span>
<span class="sd">        .. code:: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; impath = c4d.datasets.image(&#39;planes&#39;)</span>
<span class="sd">            Fetched successfully</span>
<span class="sd">            </span>

<span class="sd">        Load YOLOv3 detector and set 3 NMS threshold values to compare: </span>

<span class="sd">        .. code:: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; yolo3 = c4d.detectors.yolov3() </span>
<span class="sd">            Fetched successfully</span>
<span class="sd">            &gt;&gt;&gt; nms_thresholds = [0.1, 0.5, 0.9] </span>

<span class="sd">            </span>
<span class="sd">        Run the detector on each threshold: </span>

<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; _, axs = plt.subplots(1, 3)</span>
<span class="sd">            &gt;&gt;&gt; for i, nms_threshold in enumerate(nms_thresholds):</span>
<span class="sd">            ...   yolo3.nms_th = nms_threshold</span>
<span class="sd">            ...   img = cv2.imread(impath)</span>
<span class="sd">            ...   pts = yolo3.detect(img)</span>
<span class="sd">            ...   for p in pts:</span>
<span class="sd">            ...     cv2.rectangle(img, p.box[0], p.box[1], [0, 255, 0], 2) # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...   axs[i].imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB)) # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...   axs[i].set_title(f&quot;NMS Threshold: {nms_threshold}&quot;, fontsize = 6)</span>
<span class="sd">            ...   axs[i].axis(&#39;off&#39;) # doctest: +IGNORE_OUTPUT</span>

<span class="sd">            </span>
<span class="sd">        .. figure:: /_examples/yolov3/nms_th.png                  </span>

<span class="sd">        </span>
<span class="sd">        A high value (0.9) for the Non-Maximum Suppression (NMS) threshold here  </span>
<span class="sd">        leads to an increased number of bounding boxes around a single object.</span>
<span class="sd">        When the NMS threshold is high, it means that a significant overlap is </span>
<span class="sd">        required for two bounding boxes to be considered redundant, </span>
<span class="sd">        and one of them will be suppressed.</span>
<span class="sd">        To address this issue, it&#39;s essential to choose an appropriate </span>
<span class="sd">        NMS threshold based on the characteristics of your dataset and the </span>
<span class="sd">        level of overlap between objects. </span>
<span class="sd">        A lower NMS threshold (e.g., 0.4 or 0.5) </span>
<span class="sd">        is commonly used to suppress redundant boxes effectively </span>
<span class="sd">        while retaining accurate detections. </span>
<span class="sd">        Experimenting with different </span>
<span class="sd">        threshold values and observing their impact on the results is crucial </span>
<span class="sd">        for optimizing the performance of object detection models.</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nms_th</span> 

    <span class="nd">@nms_th</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nms_th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nms_th</span> <span class="o">=</span> <span class="n">val</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span><span class="w"> </span><span class="nf">confidence_th</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets and sets the confidence threshold used in the object detection.</span>

<span class="sd">        Detected objects with confidence scores below this threshold are filtered out.</span>
<span class="sd">        </span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        confidence_th : float</span>
<span class="sd">            The new confidence threshold for object detection. </span>
<span class="sd">            Defaults: `confidence_th = 0.5`. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        confidence_th : float</span>
<span class="sd">            The confidence threshold for object detection.</span>
<span class="sd">            Detected objects with confidence scores below this threshold are filtered out.</span>


<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        Import required packages: </span>
<span class="sd">        </span>
<span class="sd">        .. code:: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; import c4dynamics as c4d </span>
<span class="sd">            &gt;&gt;&gt; from matplotlib import pyplot as plt </span>
<span class="sd">            &gt;&gt;&gt; import cv2 </span>
<span class="sd">        </span>

<span class="sd">        Fetch &#39;planes.png&#39; using the c4dynamics&#39; datasets module (see :mod:`c4dynamics.datasets`):         </span>
<span class="sd">            </span>
<span class="sd">        .. code:: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; impath = c4d.datasets.image(&#39;planes&#39;)</span>
<span class="sd">            Fetched successfully</span>
<span class="sd">            </span>

<span class="sd">        Load YOLOv3 detector and set 3 confidence threshold values to compare: </span>
<span class="sd">        </span>
<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; yolo3 = c4d.detectors.yolov3()  </span>
<span class="sd">            Fetched successfully</span>
<span class="sd">            &gt;&gt;&gt; confidence_thresholds = [0.9, 0.95, 0.99] </span>

<span class="sd">            </span>
<span class="sd">        Run the detector on each threshold: </span>
<span class="sd">            </span>
<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; _, axs = plt.subplots(1, 3)</span>
<span class="sd">            &gt;&gt;&gt; for i, confidence_threshold in enumerate(confidence_thresholds):</span>
<span class="sd">            ...   yolo3.confidence_th = confidence_threshold</span>
<span class="sd">            ...   img = cv2.imread(impath) </span>
<span class="sd">            ...   pts = yolo3.detect(img)</span>
<span class="sd">            ...   for p in pts:</span>
<span class="sd">            ...     cv2.rectangle(img, p.box[0], p.box[1], [0, 255, 0], 2) # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...   axs[i].imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))  # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...   axs[i].set_title(f&quot;Confidence Threshold: {confidence_threshold}&quot;, fontsize = 6)</span>
<span class="sd">            ...   axs[i].axis(&#39;off&#39;) # doctest: +IGNORE_OUTPUT </span>


<span class="sd">        .. figure:: /_examples/yolov3/confidence_th.png</span>


<span class="sd">        A single object being missed, particularly when setting the confidence threshold to 0.99, </span>
<span class="sd">        suggests that the model is highly confident in its predictions. </span>
<span class="sd">        This level of performance is typically achievable when the model </span>
<span class="sd">        has been trained on a diverse and representative dataset, </span>
<span class="sd">        encompassing a wide variety of object instances, backgrounds, </span>
<span class="sd">        and conditions. </span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_th</span> 

    <span class="nd">@confidence_th</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">confidence_th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_th</span> <span class="o">=</span> <span class="n">val</span>
        


<div class="viewcode-block" id="yolov3.detect">
<a class="viewcode-back" href="../../../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.detect.html#c4dynamics.detectors.yolo3_opencv.yolov3.detect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">pixelpoint</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Detects objects in a frame using the YOLOv3 model.</span>

<span class="sd">        At each call, the detector performs the following steps:</span>

<span class="sd">        1. Preprocesses the frame by creating a blob, normalizing pixel values, and swapping Red and Blue channels.</span>

<span class="sd">        2. Sets input to the YOLOv3 model and performs a forward pass to obtain detections.</span>

<span class="sd">        3. Extracts detected objects based on a confidence threshold, calculates bounding box coordinates, and filters results using Non-Maximum Suppression (NMS).</span>

<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : numpy.array </span>
<span class="sd">            An input frame for object detection.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : list[pixelpoint]</span>
<span class="sd">            A list of :class:`pixelpoint &lt;c4dynamics.states.pixelpoint.pixelpoint&gt;` objects representing detected objects, </span>
<span class="sd">            each containing bounding box coordinates and class label.</span>

<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------        </span>

<span class="sd">        **Setup**</span>

<span class="sd">        Import required packages:</span>
<span class="sd">        </span>
<span class="sd">        .. code:: </span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; import cv2  # opencv-python </span>
<span class="sd">            &gt;&gt;&gt; import c4dynamics as c4d </span>
<span class="sd">            &gt;&gt;&gt; from matplotlib import pyplot as plt</span>

<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        Fetch &#39;planes.png&#39; and &#39;aerobatics.mp4&#39; using the c4dynamics&#39; datasets module (see :mod:`c4dynamics.datasets`):         </span>

<span class="sd">        .. code::</span>

<span class="sd">            &gt;&gt;&gt; impath = c4d.datasets.image(&#39;planes&#39;)</span>
<span class="sd">            Fetched successfully</span>
<span class="sd">            &gt;&gt;&gt; vidpath = c4d.datasets.video(&#39;aerobatics&#39;)</span>
<span class="sd">            Fetched successfully</span>


<span class="sd">            </span>
<span class="sd">        Load YOLOv3 detector: </span>
<span class="sd">        </span>
<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; yolo3 = c4d.detectors.yolov3()  </span>
<span class="sd">            Fetched successfully</span>


<span class="sd">            </span>

<span class="sd">        Let the auxiliary function:</span>

<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; def ptup(n): return &#39;(&#39; + str(n[0]) + &#39;, &#39; + str(n[1]) + &#39;)&#39;</span>

<span class="sd">            </span>

<span class="sd">        **Object detection in a single frame**</span>
<span class="sd">        </span>

<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; img = cv2.imread(impath) </span>
<span class="sd">            &gt;&gt;&gt; pts = yolo3.detect(img)</span>
<span class="sd">            &gt;&gt;&gt; for p in pts:</span>
<span class="sd">            ...   cv2.rectangle(img, p.box[0], p.box[1], [0, 255, 0], 2) # doctest: +IGNORE_OUTPUT </span>
<span class="sd">        </span>
<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; plt.figure() # doctest: +IGNORE_OUTPUT </span>
<span class="sd">            &gt;&gt;&gt; plt.axis(False) # doctest: +IGNORE_OUTPUT </span>
<span class="sd">            &gt;&gt;&gt; plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB)) # doctest: +IGNORE_OUTPUT  </span>
<span class="sd">  </span>
<span class="sd">            </span>
<span class="sd">        .. figure:: /_examples/yolov3/single_image.png</span>

<span class="sd">        </span>

<span class="sd">        **Object detection in a video**</span>
<span class="sd">        </span>
<span class="sd">        .. code::</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; video_cap = cv2.VideoCapture(vidpath)</span>
<span class="sd">            &gt;&gt;&gt; while video_cap.isOpened():</span>
<span class="sd">            ...   ret, frame = video_cap.read()</span>
<span class="sd">            ...   if not ret: break</span>
<span class="sd">            ...   pts = yolo3.detect(frame)</span>
<span class="sd">            ...   for p in pts:</span>
<span class="sd">            ...     cv2.rectangle(frame, p.box[0], p.box[1], [0, 255, 0], 2) # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...     cv2.imshow(&#39;YOLOv3&#39;, frame)  # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...   cv2.waitKey(10) # doctest: +IGNORE_OUTPUT</span>

<span class="sd">        .. figure:: /_examples/yolov3/aerobatics.gif</span>



<span class="sd">        </span>
<span class="sd">        **The output structure**</span>
<span class="sd">        </span>

<span class="sd">        The output of the detect() function is a list of :class:`pixelpoint &lt;c4dynamics.states.pixelpoint.pixelpoint&gt;` object.</span>
<span class="sd">        The :class:`pixelpoint &lt;c4dynamics.states.pixelpoint.pixelpoint&gt;` has unique attributes to manipulate the detected object class and  </span>
<span class="sd">        bounding box. </span>

<span class="sd">        .. code::</span>

<span class="sd">            &gt;&gt;&gt; print(&#39;{:^10} | {:^10} | {:^10} | {:^16} | {:^16} | {:^10} | {:^14}&#39; # doctest: +IGNORE_OUTPUT </span>
<span class="sd">            ...             .format(&#39;# object&#39;, &#39;center x&#39;, &#39;center y&#39;, &#39;box top-left&#39;, &#39;box bottom-right&#39;, &#39;class&#39;, &#39;frame size&#39;))</span>
<span class="sd">            &gt;&gt;&gt; # main loop:</span>
<span class="sd">            &gt;&gt;&gt; for i, p in enumerate(pts):</span>
<span class="sd">            ...   print(&#39;{:^10d} | {:^10.3f} | {:^10.3f} | {:^16} | {:^16} | {:^10} | {:^14}&#39;</span>
<span class="sd">            ...         .format(i, p.x, p.y, ptup(p.box[0]), ptup(p.box[1]), p.class_id, ptup(p.fsize)))</span>
<span class="sd">            ...   cv2.rectangle(img, p.box[0], p.box[1], [0, 0, 0], 2)      # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            ...   point = (int((p.box[0][0] + p.box[1][0]) / 2 - 75), p.box[1][1] + 22) </span>
<span class="sd">            ...   cv2.putText(img, p.class_id, point, cv2.FONT_HERSHEY_SIMPLEX, 1, [0, 0, 0], 2)  # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            # object  |  center x  |  center y  |   box top-left   | box bottom-right |   class    |  frame size  </span>
<span class="sd">               0      |   0.584    |   0.376    |    (691, 234)    |    (802, 306)    | aeroplane  |  (1280, 720)  </span>
<span class="sd">               1      |   0.457    |   0.473    |    (528, 305)    |    (642, 376)    | aeroplane  |  (1280, 720)  </span>
<span class="sd">               2      |   0.471    |   0.322    |    (542, 196)    |    (661, 267)    | aeroplane  |  (1280, 720)  </span>
<span class="sd">               3      |   0.546    |   0.873    |    (645, 588)    |    (752, 668)    | aeroplane  |  (1280, 720) </span>

<span class="sd">        .. code:: </span>

<span class="sd">            &gt;&gt;&gt; plt.figure()  # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            &gt;&gt;&gt; plt.axis(False) # doctest: +IGNORE_OUTPUT</span>
<span class="sd">            &gt;&gt;&gt; plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))  # doctest: +IGNORE_OUTPUT</span>
<span class="sd">        </span>
<span class="sd">        .. figure:: /_examples/yolov3/outformat.png</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#</span>
        <span class="c1"># Step 1: Preprocess the Frame</span>
        <span class="c1">#   - Create a blob (binary large object) from the input frame with the </span>
        <span class="c1">#       specified dimensions</span>
        <span class="c1">#   - Normalize pixel values to a range of 0 to 1</span>
        <span class="c1">#   - Specify the dimensions of the input layer of the YOLOv3 model</span>
        <span class="c1">#   - Swap Red and Blue channels (BGR to RGB)</span>
        <span class="c1">#   - Set crop to False to preserve the original aspect ratio</span>
        <span class="c1">##</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="n">MODEL_SIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MODEL_SIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">swapRB</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">crop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># Step 2: Set Input to the YOLOv3 Model and Perform Forward Pass</span>
        <span class="c1">#   - Set the blob as the input to the YOLOv3 model</span>
        <span class="c1">#   - Get the names of the output layers of the model</span>
        <span class="c1">#   - Perform a forward pass through the model to obtain detections</span>
        <span class="c1"># </span>
        <span class="c1"># The returning detection structure: </span>
        <span class="c1">#   1) x_center</span>
        <span class="c1">#   2) y_center</span>
        <span class="c1">#   3) width</span>
        <span class="c1">#   4) height</span>
        <span class="c1">#   5) confidence score </span>
        <span class="c1">#   6:end) probabilities for each class</span>
        <span class="c1">##</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ln</span><span class="p">)</span>
        
        <span class="c1">#</span>
        <span class="c1"># Step 3: Extract Detected Objects</span>
        <span class="c1">#   - Iterate through the detected objects in the forward pass results</span>
        <span class="c1">#   - Filter objects based on confidence threshold</span>
        <span class="c1">#   - Calculate bounding box coordinates and convert to integers</span>
        <span class="c1">#   - Append bounding box coordinates and class labels to respective lists</span>
        <span class="c1">##</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="p">[]</span>            <span class="c1"># xc, yc, w, h     </span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c1"># top left x, top left y, width, height</span>
        <span class="n">classIDs</span> <span class="o">=</span> <span class="p">[]</span>           
        <span class="n">confidences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fheight</span><span class="p">,</span> <span class="n">fwidth</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">detections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">detection</span><span class="p">:</span>
                
                <span class="n">scores</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                <span class="n">classID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">classID</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">scores</span><span class="p">[</span><span class="n">classID</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_th</span><span class="p">:</span>  <span class="c1"># Adjust the confidence threshold as needed</span>

                    <span class="n">box</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="n">fwidth</span><span class="p">,</span> <span class="n">fheight</span><span class="p">,</span> <span class="n">fwidth</span><span class="p">,</span> <span class="n">fheight</span><span class="p">]</span> <span class="c1"># relative (xc, yc, w, h) to pixels </span>
                    <span class="c1"># (center_x, center_y, width, height) = box.astype(&#39;int&#39;)</span>

                    <span class="n">x</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># top left x </span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># top left y </span>

                    <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span> <span class="c1"># top left x, top left y, width, height</span>
                    <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                    <span class="n">classIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classID</span><span class="p">)</span> 
                    <span class="n">raw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span> 


        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_th</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nms_th</span><span class="p">))</span>
        
        <span class="c1"># box_out = []</span>
        <span class="c1"># class_out = []</span>
        <span class="n">points_out</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># for i in indices.flatten():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
                <span class="c1"># (x, y) = (boxes[i][0], boxes[i][1])</span>
                <span class="c1"># (w, h) = (boxes[i][2], boxes[i][3])</span>
                <span class="c1">#               x top left, y top left,   x bottom right,           y bottom right </span>
                <span class="c1"># box_out.append([boxes[i][0], boxes[i][1], boxes[i][0] + boxes[i][2], boxes[i][1] + boxes[i][3]])</span>

                <span class="c1"># points_out.append(pixelpoint(raw[i], self.class_names[classIDs[i]], (w, h)))</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="n">pixelpoint</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fwidth</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fheight</span><span class="p">),</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fwidth</span><span class="p">),</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">fheight</span><span class="p">))</span>
                <span class="c1"># pp.units = &#39;normalized&#39;</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">fsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">fwidth</span><span class="p">,</span> <span class="n">fheight</span><span class="p">)</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">class_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_names</span><span class="p">[</span><span class="n">classIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">points_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
                
                <span class="c1"># class_out.append(self.class_names[classIDs[i]])</span>

        <span class="c1"># box_out = np.array(box_out)</span>
        
        <span class="k">return</span> <span class="n">points_out</span> <span class="c1"># box_out, class_out,  </span></div>
</div>






<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

  <span class="kn">import</span><span class="w"> </span><span class="nn">doctest</span><span class="o">,</span><span class="w"> </span><span class="nn">contextlib</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">c4dynamics</span><span class="w"> </span><span class="kn">import</span> <span class="n">IgnoreOutputChecker</span><span class="p">,</span> <span class="n">cprint</span>
  
  <span class="c1"># Register the custom OutputChecker</span>
  <span class="n">doctest</span><span class="o">.</span><span class="n">OutputChecker</span> <span class="o">=</span> <span class="n">IgnoreOutputChecker</span>

  <span class="n">tofile</span> <span class="o">=</span> <span class="kc">False</span> 
  <span class="n">optionflags</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">FAIL_FAST</span>

  <span class="k">if</span> <span class="n">tofile</span><span class="p">:</span> 
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="s1">&#39;_out&#39;</span><span class="p">,</span> <span class="s1">&#39;output.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stderr</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">optionflags</span> <span class="o">=</span> <span class="n">optionflags</span><span class="p">)</span> 
  <span class="k">else</span><span class="p">:</span> 
    <span class="n">result</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">optionflags</span> <span class="o">=</span> <span class="n">optionflags</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">failed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">cprint</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: all tests passed!&quot;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">failed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>



</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By c4dynamics
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023, c4dynamics.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Mar 13, 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>