
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ballistic Coefficient Estimation using Extended Kalman Filter &#8212; C4DYNAMICS v2.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=32e37178"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'programs/ballistic_coefficient';</script>
    <link rel="icon" href="../_static/c4dlogo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cars Tracker using Kalman Filter and Objects Detection Model" href="car_tracker.html" />
    <link rel="prev" title="Proportional Navigation Guidance - 6 Degrees of Freedom Simulation" href="dof6sim.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Oct 13, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">C4DYNAMICS v2.1</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Home
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../concepts/states.html">State Objects</a></li>

<li class="toctree-l1"><a class="reference internal" href="../concepts/kinematics.html">Kinematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/transformations.html">Rigid Body Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/rl_env.html">Reinforcement Learning Enviroenment</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dof6sim.html">Proportional Navigation Guidance - 6 Degrees of Freedom</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ballistic Coefficient Estimation using Extended Kalman Filter</a></li>


<li class="toctree-l1"><a class="reference internal" href="car_tracker.html">Car Tracker - Objects Detection and Kalman Filter</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/States.html">State Objects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/states.state.html">The State Class</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.X.html">c4dynamics.states.state.state.X</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.X0.html">c4dynamics.states.state.state.X0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.norm.html">c4dynamics.states.state.state.norm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.normalize.html">c4dynamics.states.state.state.normalize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.Position.html">c4dynamics.states.state.state.Position</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.Velocity.html">c4dynamics.states.state.state.Velocity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.addvars.html">c4dynamics.states.state.state.addvars</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.P.html">c4dynamics.states.state.state.P</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.V.html">c4dynamics.states.state.state.V</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.store.html">c4dynamics.states.state.state.store</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.storeparams.html">c4dynamics.states.state.state.storeparams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.data.html">c4dynamics.states.state.state.data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.timestate.html">c4dynamics.states.state.state.timestate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/state/c4dynamics.states.state.state.plot.html">c4dynamics.states.state.state.plot</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/states.lib.html">States Library</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/states.lib.datapoint.html">Datapoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/states.lib.rigidbody.html">Rigidbody</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/states.lib.pixelpoint.html">Pixelpoint</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/Sensors.html">Sensors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/sensors.seeker.html">Seeker</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/seeker/c4dynamics.sensors.seeker.seeker.bias.html">c4dynamics.sensors.seeker.seeker.bias</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/seeker/c4dynamics.sensors.seeker.seeker.scale_factor.html">c4dynamics.sensors.seeker.seeker.scale_factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/seeker/c4dynamics.sensors.seeker.seeker.measure.html">c4dynamics.sensors.seeker.seeker.measure</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/sensors.radar.html">Radar</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/radar/c4dynamics.sensors.radar.radar.bias.html">c4dynamics.sensors.radar.radar.bias</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/radar/c4dynamics.sensors.radar.radar.scale_factor.html">c4dynamics.sensors.radar.radar.scale_factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/radar/c4dynamics.sensors.radar.radar.measure.html">c4dynamics.sensors.radar.radar.measure</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/Detectors.html">Detectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/detectors.yolov3.html">YOLOv3</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.nms_th.html">c4dynamics.detectors.yolo3_opencv.yolov3.nms_th</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.confidence_th.html">c4dynamics.detectors.yolo3_opencv.yolov3.confidence_th</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/yolov3/c4dynamics.detectors.yolo3_opencv.yolov3.detect.html">c4dynamics.detectors.yolo3_opencv.yolov3.detect</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/Filters.html">Filters</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/filters.kalman.html">Kalman filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/kalman/c4dynamics.filters.kalman.kalman.predict.html">c4dynamics.filters.kalman.kalman.predict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/kalman/c4dynamics.filters.kalman.kalman.update.html">c4dynamics.filters.kalman.kalman.update</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/kalman/c4dynamics.filters.kalman.kalman.store.html">c4dynamics.filters.kalman.kalman.store</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/filters.ekf.html">Extended Kalman filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/ekf/c4dynamics.filters.ekf.ekf.predict.html">c4dynamics.filters.ekf.ekf.predict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/ekf/c4dynamics.filters.ekf.ekf.update.html">c4dynamics.filters.ekf.ekf.update</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/ekf/c4dynamics.filters.ekf.ekf.store.html">c4dynamics.filters.ekf.ekf.store</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/filters.lpf.html">Lowpass filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/lpf/c4dynamics.filters.lowpass.lowpass.sample.html">c4dynamics.filters.lowpass.lowpass.sample</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/eqm.html">Kinematics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/eqm/c4dynamics.eqm.derivs.eqm3.html">c4dynamics.eqm.derivs.eqm3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/eqm/c4dynamics.eqm.derivs.eqm6.html">c4dynamics.eqm.derivs.eqm6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/eqm/c4dynamics.eqm.integrate.int3.html">c4dynamics.eqm.integrate.int3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/eqm/c4dynamics.eqm.integrate.int6.html">c4dynamics.eqm.integrate.int6</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/rotmat.html">Rotations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/rotmat/c4dynamics.rotmat.rotmat.rotx.html">c4dynamics.rotmat.rotmat.rotx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/rotmat/c4dynamics.rotmat.rotmat.roty.html">c4dynamics.rotmat.rotmat.roty</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/rotmat/c4dynamics.rotmat.rotmat.rotz.html">c4dynamics.rotmat.rotmat.rotz</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/rotmat/c4dynamics.rotmat.rotmat.dcm321.html">c4dynamics.rotmat.rotmat.dcm321</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/rotmat/c4dynamics.rotmat.rotmat.dcm321euler.html">c4dynamics.rotmat.rotmat.dcm321euler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/rotmat/c4dynamics.rotmat.animate.animate.html">c4dynamics.rotmat.animate.animate</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/Utils.html">Utils</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/utils/c4dynamics.utils.tictoc.tic.html">c4dynamics.utils.tictoc.tic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/utils/c4dynamics.utils.tictoc.toc.html">c4dynamics.utils.tictoc.toc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/utils/c4dynamics.utils.cprint.cprint.html">c4dynamics.utils.cprint.cprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/utils/c4dynamics.utils.gen_gif.gif.html">c4dynamics.utils.gen_gif.gif</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/utils/c4dynamics.utils.plottools.plotdefaults.html">c4dynamics.utils.plottools.plotdefaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.math.html">Math Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.const.html">Constants</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/Datasets.html">Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/datasets/c4dynamics.datasets.image.html">c4dynamics.datasets.image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/datasets/c4dynamics.datasets.video.html">c4dynamics.datasets.video</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/datasets/c4dynamics.datasets.nn_model.html">c4dynamics.datasets.nn_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/datasets/c4dynamics.datasets.d3_model.html">c4dynamics.datasets.d3_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/datasets/c4dynamics.datasets.download_all.html">c4dynamics.datasets.download_all</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/datasets/c4dynamics.datasets.clear_cache.html">c4dynamics.datasets.clear_cache</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/programs/ballistic_coefficient.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ballistic Coefficient Estimation using Extended Kalman Filter</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Ballistic Coefficient Estimation using Extended Kalman Filter</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Priliminary-Remarks">Priliminary Remarks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Extended-Kalman-Filter-(EKF)">Extended Kalman Filter (EKF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Dynamics-[1]">Dynamics <code class="docutils literal notranslate"><span class="pre">[1]</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1^{st}-Case:-Ideal-Radar"><span class="math notranslate nohighlight">\(1^{st}\)</span> Case: Ideal Radar</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Setup-&amp;-Initial-Conditions">Setup &amp; Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Main-Loop">Main Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Plotting">Plotting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2^{nd}-Case:-Noisy-Radar"><span class="math notranslate nohighlight">\(2^{nd}\)</span> Case: Noisy Radar</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Setup &amp; Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Main Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Results">Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3^{rd}-Case:-Filterring"><span class="math notranslate nohighlight">\(3^{rd}\)</span> Case: Filterring</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Initial-Conditions">Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#System-Matrices">System Matrices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Noise-Covariances-(Q,-R)">Noise Covariances (Q, R)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Main Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Conclusion">Conclusion</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#References">References</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <ul class="simple">
<li><p>To download this notebook, click the download icon in the toolbar above and select the .ipynb format.</p></li>
<li><p>For any questions or comments, please open an issue on the <a class="reference external" href="https://github.com/C4dynamics/C4dynamics/issues">c4dynamics issues page</a>.</p></li>
</ul>
<section id="Ballistic-Coefficient-Estimation-using-Extended-Kalman-Filter">
<h1>Ballistic Coefficient Estimation using Extended Kalman Filter<a class="headerlink" href="#Ballistic-Coefficient-Estimation-using-Extended-Kalman-Filter" title="Link to this heading">#</a></h1>
<p>An estimatation of the ballistic coefficient of a target in a free fall tracked by a noisy altimeter radar.</p>
<section id="Priliminary-Remarks">
<h2>Priliminary Remarks<a class="headerlink" href="#Priliminary-Remarks" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>The mathematical background required for understanding the Extended Kalman Filter and the form of implementation used by <code class="docutils literal notranslate"><span class="pre">c4dynamics</span></code> is found in <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/Filters.html#extended-kalman-filter-ekf">the introduction page to the filters module documentary</a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ekf</span></code> class API is found <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/filters.ekf.html#c4dynamics.filters.ekf.ekf">here</a>.</p></li>
<li><p>Zarchan <code class="docutils literal notranslate"><span class="pre">[1]</span></code> provides a great deal of detail about this example. Additional sources can be found in <code class="docutils literal notranslate"><span class="pre">[2]</span></code>.</p></li>
</ol>
<div style="text-align: center;"><p><img alt="alt text" src="../_images/ekf.drawio.png" /></p>
<figcaption><p>Figure 1: Flowchart of the simulation. The target dynamics uses as a reference to the Kalman prediction and the radar measurements correct the estimates. When the loop is over, all the data is transmitted outside to plot results.</p>
</figcaption></div></section>
<section id="Extended-Kalman-Filter-(EKF)">
<h2>Extended Kalman Filter (EKF)<a class="headerlink" href="#Extended-Kalman-Filter-(EKF)" title="Link to this heading">#</a></h2>
<p>The basics of EKF were covered in <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/Filters.html#extended-kalman-filter-ekf">the filters introduction</a> to provide the background material required for the understanding and developing state estimation for nonlinear systems. Here is a brief recap:</p>
<ul class="simple">
<li><p>A linear Kalman filter (<a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/filters.kalman.html">kalman</a>) should be the first choice when designing a state observer. However, when a nominal trajectory cannot be found, the solution is to linearize the system at each cycle about the current estimated state (that is what the EKF does).</p></li>
<li><p>The linearization is required for the iterative solution to the algebraic Riccati equation. The Riccati equation is using to calculate Kalman gain and the optimal covariance matrix.</p></li>
<li><p>Similarly to the linear Kalman filter, a good approach to design an extended Kalman filter is to separate it to two steps: predict and update (correct).</p></li>
<li><p>The calculation of the state vector both in the predict step (projection in time using the process equations) and in the update step (correction using the measure equations) does not have to use the approximated linear expressions and can use the exact nonlinear equations.</p></li>
</ul>
</section>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">c4dynamics</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">c4d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="mf">.01</span><span class="p">,</span> <span class="mi">30</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tf</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">dtsensor</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">rho0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">0.0034</span><span class="p">,</span> <span class="mi">22000</span>
</pre></div>
</div>
</div>
</section>
<section id="Dynamics-[1]">
<h2>Dynamics <code class="docutils literal notranslate"><span class="pre">[1]</span></code><a class="headerlink" href="#Dynamics-[1]" title="Link to this heading">#</a></h2>
<p>The estimation of the ballistic coefficient requires simulating the target. This involves determining parameters and modeling its dynamics, i.e. the equations of motion.</p>
<p>When a ballistic target re-enters the atmosphere after having traveled a long distance, its speed is high and the remaining time to ground impact is relatively short.</p>
<p>The small distances traveled by ballistic targets after they re-enter the atmosphere enable to accurately model these threats using the flat-Earth, constant gravity approximation.</p>
<p>In this model, only drag and gravity act on the ballistic target.</p>
<div style="text-align: center;"><p><img alt="alt text" src="../_images/ekf.balance.png" /></p>
<figcaption><p>Figure 2: A radar tracking the distance of a ballistic target in the altitude direction</p>
</figcaption></div><p>The acceleration components of the ballistic target in the altitude direction can either be expressed in terms of the target weight <span class="math notranslate nohighlight">\(W\)</span>, reference area <span class="math notranslate nohighlight">\(s_{ref}\)</span>, zero lift drag <span class="math notranslate nohighlight">\(C_{d_0}\)</span>, and gravity <span class="math notranslate nohighlight">\(g\)</span>, or more simply in terms of the ballistic coefficient <span class="math notranslate nohighlight">\(\beta\)</span> according to</p>
<div class="math notranslate nohighlight">
\[\frac{dv}{dt} = \frac{F_{drag}}{m} - g = \frac{Q⋅s_{ref}⋅C_{d_0}⋅g}{W} - g = \frac{Q⋅g}{\beta} - g\]</div>
<p>Where <span class="math notranslate nohighlight">\(Q\)</span> is the dynamic pressure = <span class="math notranslate nohighlight">\(0.5⋅\rho⋅v^2\)</span>, with air density <span class="math notranslate nohighlight">\(\rho\)</span> given by the approximated term:</p>
<div class="math notranslate nohighlight">
\[\rho = 0.0034 ⋅ e^{-z / 22000}\]</div>
<p>Since the acceleration equation is in inertial frame it can be integrated directly to yield velocity and position.</p>
<p>Let the state vector include the target altitude, vertical velocity, and ballistic coefficient:</p>
<div class="math notranslate nohighlight">
\[\begin{split}x = \begin{bmatrix}
z \\
v_z \\
\beta
\end{bmatrix}\end{split}\]</div>
<p>The above acceleration term leads to the set of ordinary differential equations describing the system:</p>
<div class="math notranslate nohighlight">
\[\dot{z} = v_z\]</div>
<div class="math notranslate nohighlight">
\[\dot{v}_z = {\rho_0 \cdot e^{-z / k} \cdot v_z^2 \cdot g \over 2 \cdot \beta} - g\]</div>
<div class="math notranslate nohighlight">
\[\dot{\beta} = \omega_{\beta}\]</div>
<p>With output measure:</p>
<div class="math notranslate nohighlight">
\[y = z + \nu_k\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(z\)</span> is the target altitude (<span class="math notranslate nohighlight">\(ft\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(v_z\)</span> is the target vertical velocity (<span class="math notranslate nohighlight">\(ft/s\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> is the target ballistic coefficient (<span class="math notranslate nohighlight">\(lb/ft^2\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(y\)</span> is the system output</p></li>
<li><p><span class="math notranslate nohighlight">\(\omega_{\beta} \sim (0, 300)\)</span>, the uncertainty in the ballistic coefficient behavior</p></li>
<li><p><span class="math notranslate nohighlight">\(\nu_k \sim (0, 500)\)</span>, the measurement noise</p></li>
<li><p><span class="math notranslate nohighlight">\(g = 32.2 ft/s^2\)</span>, the gravitational constant</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho_{0} = 0.0034\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(k = 22,000\)</span></p></li>
</ul>
<p>In the form of <code class="docutils literal notranslate"><span class="pre">ODE</span></code> function, these equations are given in the ballistic function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ballistics</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>

  <span class="n">z</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">y</span>

  <span class="n">z_dot</span>     <span class="o">=</span> <span class="n">vz</span>
  <span class="n">vz_dot</span>    <span class="o">=</span> <span class="n">rho0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">vz</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c4d</span><span class="o">.</span><span class="n">g_fts2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">c4d</span><span class="o">.</span><span class="n">g_fts2</span>
  <span class="n">beta_dot</span>  <span class="o">=</span> <span class="mi">0</span>

  <span class="k">return</span> <span class="p">[</span><span class="n">z_dot</span><span class="p">,</span> <span class="n">vz_dot</span><span class="p">,</span> <span class="n">beta_dot</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">g_fts2</span></code> is the <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/utils.const.html">gravity constant</a> in foot per seconds squared.</p>
</section>
<section id="1^{st}-Case:-Ideal-Radar">
<h2><span class="math notranslate nohighlight">\(1^{st}\)</span> Case: Ideal Radar<a class="headerlink" href="#1^{st}-Case:-Ideal-Radar" title="Link to this heading">#</a></h2>
<p>Let’s start with a simple measure of the target position where no errors or uncertainties are present. The state variables are taken from the ground truth simulation without running an estimation.</p>
<section id="Setup-&amp;-Initial-Conditions">
<h3>Setup &amp; Initial Conditions<a class="headerlink" href="#Setup-&-Initial-Conditions" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tgt</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6000</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">altmtr</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">radar</span><span class="p">(</span><span class="n">isideal</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">The target is implemented by a <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/states.state.html">state object</a> with three variables: altitude, vertical velocity, and ballistic coefficient.</div>
<div class="line">The <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/sensors.radar.html">radar</a> is taken from the scientific library of c4dynamics, particularly, the seekers module. The introudced parameters indicate the required errors model (<em>ideal case</em>) and the samples rate (<span class="math notranslate nohighlight">\(10ms\)</span>).</div>
</div>
</section>
<section id="Main-Loop">
<h3>Main Loop<a class="headerlink" href="#Main-Loop" title="Link to this heading">#</a></h3>
<p>The main loop in the ideal case does three things:</p>
<ol class="arabic simple">
<li><p>Stores the current state</p></li>
<li><p>Integrates the system equations of motion</p></li>
<li><p>Samples the radar</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tspan</span><span class="p">:</span>
  <span class="n">tgt</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="n">tgt</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">ballistics</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">altmtr</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">store</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Plotting">
<h3>Plotting<a class="headerlink" href="#Plotting" title="Link to this heading">#</a></h3>
<p>Let’s write a plotting function to draw the results in the ideal case as well as in later cases.</p>
<p>The parameters of the function <code class="docutils literal notranslate"><span class="pre">drawekf()</span></code> enable to control the elements of the components to draw:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ekf</span></code>: estimated object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trueobj</span></code>: ground truth reference to the estimation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">measure</span></code>: the raw samples of the sensor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std</span></code>: the square root of the covariance matrix <span class="math notranslate nohighlight">\(P\)</span>, representing one standard deviation of the estimation error</p></li>
</ul>
<p>Each subplot calls <code class="docutils literal notranslate"><span class="pre">plotdefaults()</span></code> from c4dynamics <a class="reference external" href="https://c4dynamics.github.io/C4dynamics/api/generated/utils/c4dynamics.utils.plottools.plotdefaults.html">utils</a> to set default properties for an axis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">drawekf</span><span class="p">(</span><span class="n">ekf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">trueobj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">measures</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">txtcaption</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                              <span class="p">,</span> <span class="n">gridspec_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="mf">.15</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="mf">.95</span>
                                                <span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="mf">.80</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span> <span class="mf">.15</span>
                                                  <span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;wspace&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">})</span>

  <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;                &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span>


<span class="w">  </span><span class="sd">&#39;&#39;&#39; altitude &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">trueobj</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">trueobj</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">measures</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">measures</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">),</span> <span class="s1">&#39;.c&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;altmeter&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">ekf</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;ekf&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">std</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t_sig</span><span class="p">,</span> <span class="n">x_sig</span> <span class="o">=</span> <span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;P00&#39;</span><span class="p">)</span>
    <span class="c1"># ±std</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_sig</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_sig</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;std&#39;</span><span class="p">)</span> <span class="c1"># np.array(v.color) / 255)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_sig</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_sig</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="c1"># np.array(v.color) / 255)</span>

  <span class="n">c4d</span><span class="o">.</span><span class="n">plotdefaults</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Altitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Time [s]&#39;</span><span class="p">,</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="s1">&#39;xx-small&#39;</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">)</span>


<span class="w">  </span><span class="sd">&#39;&#39;&#39; velocity &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">trueobj</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">trueobj</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;vz&#39;</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">ekf</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;vz&#39;</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;ekf&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">std</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;vz&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t_sig</span><span class="p">,</span> <span class="n">x_sig</span> <span class="o">=</span> <span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;P11&#39;</span><span class="p">)</span>
    <span class="c1"># ±std</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_sig</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_sig</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;std&#39;</span><span class="p">)</span> <span class="c1"># np.array(v.color) / 255)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_sig</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_sig</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="c1"># np.array(v.color) / 255)</span>

  <span class="n">c4d</span><span class="o">.</span><span class="n">plotdefaults</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Velocity&#39;</span><span class="p">,</span> <span class="s1">&#39;Time [s]&#39;</span><span class="p">,</span> <span class="s1">&#39;ft/s&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>


<span class="w">  </span><span class="sd">&#39;&#39;&#39; ballistic coefficient &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">trueobj</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">trueobj</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="c1"># label = r&#39;$\gamma$&#39;) #&#39;\\gamma&#39;) #</span>

  <span class="k">if</span> <span class="n">ekf</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;ekf&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">std</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t_sig</span><span class="p">,</span> <span class="n">x_sig</span> <span class="o">=</span> <span class="n">ekf</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;P22&#39;</span><span class="p">)</span>
    <span class="c1"># ±std</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_sig</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_sig</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;std&#39;</span><span class="p">)</span> <span class="c1"># np.array(v.color) / 255)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_sig</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_sig</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="c1"># np.array(v.color) / 255)</span>

  <span class="n">c4d</span><span class="o">.</span><span class="n">plotdefaults</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Beta&#39;</span><span class="p">,</span> <span class="s1">&#39;Time [s]&#39;</span><span class="p">,</span> <span class="s1">&#39;lb/ft^2&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>


  <span class="k">if</span> <span class="n">txtcaption</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">],</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">,))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">txtcaption</span><span class="p">,</span> <span class="n">wrap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">ax</span>
<br/></pre></div>
</div>
</div>
<p>Now we can call <code class="docutils literal notranslate"><span class="pre">drawekf()</span></code> to plot the results of the ideal case:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawekf</span><span class="p">(</span><span class="n">trueobj</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">measures</span> <span class="o">=</span> <span class="n">altmtr</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Ideal&#39;</span><span class="p">,</span> <span class="n">txtcaption</span> <span class="o">=</span> <span class="s2">&quot;Figure 3: Time histories of the target altitude, velocity, and ballistic coefficient.</span><span class="se">\n</span><span class="s2">Magenta = true target, cyan = radar samples.&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/programs_ballistic_coefficient_30_0.png" src="../_images/programs_ballistic_coefficient_30_0.png" />
</div>
</div>
<p>The magenta lines represent the true target properties while the cyan dots stand for the radar samples (the radar measures only the position). The ideal nature of the system is manifested by the exact location of the samples on the true position.</p>
</section>
</section>
<section id="2^{nd}-Case:-Noisy-Radar">
<h2><span class="math notranslate nohighlight">\(2^{nd}\)</span> Case: Noisy Radar<a class="headerlink" href="#2^{nd}-Case:-Noisy-Radar" title="Link to this heading">#</a></h2>
<p>Before running the filter, let’s ovserve the radar measurements in the presence of realistic parameters.</p>
<p>The parameter <span class="math notranslate nohighlight">\(\nu = \sqrt{500}\)</span> (<span class="math notranslate nohighlight">\(\nu\)</span> is <code class="docutils literal notranslate"><span class="pre">nu</span></code>) represents one standard deviation of the noise, i.e. the radar noise is a white noise with mean <span class="math notranslate nohighlight">\(0\)</span> and standard deviation <span class="math notranslate nohighlight">\(\sqrt{500}\)</span>.</p>
<p>In addition, the sample rate is changed from the previous <span class="math notranslate nohighlight">\(10ms\)</span> to a lower rate of <span class="math notranslate nohighlight">\(50ms\)</span>.</p>
<section id="id1">
<h3>Setup &amp; Initial Conditions<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">tgt</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6000</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">altmtr</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">radar</span><span class="p">(</span><span class="n">rng_noise_std</span> <span class="o">=</span> <span class="n">nu</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">dtsensor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id2">
<h3>Main Loop<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tspan</span><span class="p">:</span>
  <span class="n">tgt</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="n">tgt</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">ballistics</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">altmtr</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">store</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Results">
<h3>Results<a class="headerlink" href="#Results" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">drawekf</span><span class="p">(</span><span class="n">trueobj</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">measures</span> <span class="o">=</span> <span class="n">altmtr</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Noisy&#39;</span><span class="p">,</span> <span class="n">txtcaption</span> <span class="o">=</span> <span class="s2">&quot;Figure 4: Time histories of the target altitude, velocity, and ballistic coefficient.</span><span class="se">\n</span><span class="s2">Magenta = true target, cyan = samples by nonideal radar.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/programs_ballistic_coefficient_39_0.png" src="../_images/programs_ballistic_coefficient_39_0.png" />
</div>
</div>
<p>To observe the effect of the radar’s realistic parameters, we need to focus on a small range of the altitude axis:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">gridspec_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="mf">.15</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="mf">.95</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="mf">.80</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span> <span class="mf">.15</span><span class="p">})</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">tgt</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">altmtr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">),</span> <span class="s1">&#39;.c&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;altmeter&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">850</span><span class="p">))</span>
<span class="n">c4d</span><span class="o">.</span><span class="n">plotdefaults</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;Altitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">,))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;Figure 5: Focus on an arbitrary part of the target altitude.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Magenta = true target, cyan = samples by nonideal radar.&quot;</span>
                <span class="p">,</span> <span class="n">wrap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/programs_ballistic_coefficient_41_0.png" src="../_images/programs_ballistic_coefficient_41_0.png" />
</div>
</div>
<div class="line-block">
<div class="line">It is now evident that measurement errors can reach values as high as tens of feet, as predicted by a standard deviation of <span class="math notranslate nohighlight">\(\sqrt{500} ≈ 22\)</span> ft.</div>
<div class="line">Another property observable in Figure 5 is the radar’s operation rate, which captures 20 samples per second, corresponding to <code class="docutils literal notranslate"><span class="pre">dt</span> <span class="pre">=</span> <span class="pre">50ms</span></code>.</div>
</div>
</section>
</section>
<section id="3^{rd}-Case:-Filterring">
<h2><span class="math notranslate nohighlight">\(3^{rd}\)</span> Case: Filterring<a class="headerlink" href="#3^{rd}-Case:-Filterring" title="Link to this heading">#</a></h2>
<p>Let us examine the capability of the <code class="docutils literal notranslate"><span class="pre">ekf</span></code> to estimate the system state, including the ballistic coefficient <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
<p>First, consider the following key points:</p>
<ol class="arabic simple">
<li><p>In our problem, only the process equations are nonlinear, but the measurement equations are linear (the radar actually measures the altitude directly).</p></li>
<li><p>The covariance matrices <span class="math notranslate nohighlight">\(Q\)</span> and <span class="math notranslate nohighlight">\(R\)</span> which represent the uncertainties in the process and the measurement respectively, are time invariant.</p></li>
</ol>
<p>Consequently, initializing and operating the filter involves the following steps:</p>
<ul class="simple">
<li><p>Initialize the filter with initial conditions, covariance matrices <span class="math notranslate nohighlight">\(Q\)</span> and <span class="math notranslate nohighlight">\(R\)</span>, and the measurement matrix <span class="math notranslate nohighlight">\(H\)</span>.</p></li>
<li><p>Find expression to the process equations Jacobian matrix.</p></li>
<li><p>Run the main loop:</p></li>
<li><p>Before each call to <code class="docutils literal notranslate"><span class="pre">predict()</span></code>, evaluate the linearized process using the Jacobian matrix.</p></li>
<li><p>Correct the estimate with the radar measurements.</p></li>
</ul>
<section id="Initial-Conditions">
<h3>Initial Conditions<a class="headerlink" href="#Initial-Conditions" title="Link to this heading">#</a></h3>
<p>Since the initial conditions are not precisely known, let us define the following errors:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zerr</span> <span class="o">=</span> <span class="mi">25</span>       <span class="c1"># initial error in position</span>
<span class="n">vzerr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">150</span>      <span class="c1"># initial error in velocity</span>
<span class="n">betaerr</span> <span class="o">=</span> <span class="mi">300</span>       <span class="c1"># initial error in ballistic coefficient</span>
</pre></div>
</div>
</div>
</section>
<section id="System-Matrices">
<h3>System Matrices<a class="headerlink" href="#System-Matrices" title="Link to this heading">#</a></h3>
<div class="line-block">
<div class="line">The process equations are nonlinear, so there is no constant matrix <span class="math notranslate nohighlight">\(F\)</span> to represent them. This matrix must be re-evaluated before each call to <code class="docutils literal notranslate"><span class="pre">predict()</span></code>, as discussed below.</div>
<div class="line">However, the radar directly measures the target’s altitude, so the measurement matrix is simply:</div>
</div>
<div class="math notranslate nohighlight">
\[H = \begin{bmatrix}
      1 &amp; 0 &amp; 0
    \end{bmatrix}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">The covariance matrix <span class="math notranslate nohighlight">\(P\)</span> is evaluated by the iterative solution of the algebraic Riccati equation. However, its initial condition must represent the errors of the state variables.</div>
<div class="line">We can use the errors that defined earlier to initialize the covariane matrix:</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">vzerr</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">betaerr</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="Noise-Covariances-(Q,-R)">
<h3>Noise Covariances (Q, R)<a class="headerlink" href="#Noise-Covariances-(Q,-R)" title="Link to this heading">#</a></h3>
<div class="line-block">
<div class="line">The uncertainty in the process model is associated with the ballistic coefficient.</div>
<div class="line">Given in terms of the spectral density of a continuous system, the standard deviation of the ballistic coefficient noise is <span class="math notranslate nohighlight">\(\omega_{\beta} = \sqrt{\beta_{err} \cdot t_f}\)</span>, where <span class="math notranslate nohighlight">\(\beta_{err}\)</span> is the initial error in the ballistic coefficient and <span class="math notranslate nohighlight">\(t_f\)</span> is the target flight time.</div>
</div>
<p>The measurement noise is characterized by <span class="math notranslate nohighlight">\(\nu = \sqrt{500}\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">dt</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">betaerr</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">tf</span> <span class="o">*</span> <span class="n">dt</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="id3">
<h3>Setup<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="line-block">
<div class="line">Now that we have defined the initial conditions and the system matrices, we can proceed to setup an Extended Kalman filter.</div>
<div class="line">The initialization of an <code class="docutils literal notranslate"><span class="pre">ekf</span></code> object begins with a dictionary <span class="math notranslate nohighlight">\(X\)</span> containing the state variables and their initial conditions.</div>
<div class="line">Then, with a diagonal matrix of initial state variances <span class="math notranslate nohighlight">\(P\)</span>.</div>
<div class="line">Finally, it requires the constant system matrices, which in this case include all matrices except the process matrix.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tgt</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6000</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">altmtr</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">radar</span><span class="p">(</span><span class="n">rng_noise_std</span> <span class="o">=</span> <span class="n">nu</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">dtsensor</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39; Extended Kalman filter initialization &#39;&#39;&#39;</span>
<span class="n">ekf</span> <span class="o">=</span> <span class="n">c4d</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">ekf</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">tgt</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">zerr</span><span class="p">,</span> <span class="s1">&#39;vz&#39;</span><span class="p">:</span> <span class="n">tgt</span><span class="o">.</span><span class="n">vz</span> <span class="o">+</span> <span class="n">vzerr</span>
                                       <span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">tgt</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="n">betaerr</span><span class="p">}</span>
                                           <span class="p">,</span> <span class="n">P0</span> <span class="o">=</span> <span class="n">P0</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">H</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id4">
<h3>Main Loop<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>Since the process is nonlinear (which is the primary reason for EKF over a linear Kalman), the process equations must be linearized in each cycle around the current estimated state. To do that, we need to find an analytic expression of the nonlinear equations Jacobian, which happens to be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}A = \begin{bmatrix}
      0 &amp; 1 &amp; 0 \\
        -\rho \cdot g \cdot v_z^2 / (44000 \cdot \beta)
        &amp; \rho \cdot g \cdot v_z / \beta
        &amp; -\rho \cdot g \cdot v_z^2 \cdot / (2 \cdot \beta^2) \\
          0 &amp; 0 &amp; 0
    \end{bmatrix}\end{split}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\rho = \rho_0 \cdot e^{-z / k}\]</div>
<p>Finally, the discrete form of the process matrix is:</p>
<div class="math notranslate nohighlight">
\[F = I + A \cdot dt\]</div>
<p>Where <span class="math notranslate nohighlight">\(I\)</span> is the identity matrix and <span class="math notranslate nohighlight">\(dt\)</span> is the discretization step size.</p>
<p>Note that although the process is linearized, the nonlinear equations are still passed to the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function to integrate the derivatives using their exact expressions.</p>
<p>All the steps described earlier appear in the following main loop with a comment line entitling every section:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tspan</span><span class="p">:</span>
  <span class="c1"># store states</span>
  <span class="n">tgt</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="n">ekf</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="c1"># target motion simulation</span>
  <span class="n">tgt</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">ballistics</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="c1"># process linearization</span>
  <span class="n">rhoexp</span> <span class="o">=</span> <span class="n">rho0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ekf</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">c4d</span><span class="o">.</span><span class="n">g_fts2</span> <span class="o">*</span> <span class="n">ekf</span><span class="o">.</span><span class="n">vz</span> <span class="o">/</span> <span class="n">ekf</span><span class="o">.</span><span class="n">beta</span>
  <span class="n">fx</span> <span class="o">=</span> <span class="p">[</span><span class="n">ekf</span><span class="o">.</span><span class="n">vz</span><span class="p">,</span> <span class="n">rhoexp</span> <span class="o">*</span> <span class="n">ekf</span><span class="o">.</span><span class="n">vz</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">c4d</span><span class="o">.</span><span class="n">g_fts2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">f2i</span> <span class="o">=</span> <span class="n">rhoexp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">ekf</span><span class="o">.</span><span class="n">vz</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">ekf</span><span class="o">.</span><span class="n">vz</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">ekf</span><span class="o">.</span><span class="n">beta</span><span class="p">])</span>
  <span class="c1"># discretization</span>
  <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f2i</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="c1"># ekf predict</span>
  <span class="n">ekf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="p">,</span> <span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="p">)</span>
  <span class="c1"># take a measure</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">altmtr</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">store</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">Z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># ekf update</span>
    <span class="n">ekf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id5">
<h3>Results<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawekf</span><span class="p">(</span><span class="n">trueobj</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">measures</span> <span class="o">=</span> <span class="n">altmtr</span><span class="p">,</span> <span class="n">ekf</span> <span class="o">=</span>  <span class="n">ekf</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Filtered&#39;</span><span class="p">,</span> <span class="n">txtcaption</span> <span class="o">=</span> <span class="s2">&quot;Figure 6: Extended Kalman filter estimation of target position, velocity, and ballistic coefficient.</span><span class="se">\n</span><span class="s2">Magenta = true target, cyan = samples by nonideal radar, yellow = estimated target.&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/programs_ballistic_coefficient_69_0.png" src="../_images/programs_ballistic_coefficient_69_0.png" />
</div>
</div>
<p>The position and velocity estimates are straightforward. The velocity estimation starts with an error of <span class="math notranslate nohighlight">\(−150 ft/s\)</span>, as defined, and quickly converges to the true target velocity. The ballistic coefficient estimation begins with a relatively large error but converges to the true value after an initial overshoot.</p>
<p>The improvement at later times corresponds to a descent in altitude. It occurs at approximately <span class="math notranslate nohighlight">\(60 kft\)</span> altitude, below which the extended Kalman filter provides an excellent estimate of the target’s ballistic coefficient. For initial altitudes higher than <span class="math notranslate nohighlight">\(100 kft\)</span>, however, the EKF may struggle to achieve similar results. The ballistic coefficient is not observable, from position measurements alone, at high altitudes due to the absence of significant drag forces.</p>
<div class="line-block">
<div class="line">Another scenario where the filter may fail is when there is a relatively large error in the initial conditions. For example, we set <span class="math notranslate nohighlight">\(\beta_0 = 800\)</span>, which is <span class="math notranslate nohighlight">\(300\)</span> higher than the true coefficient value.</div>
<div class="line">However, for errors as large as <span class="math notranslate nohighlight">\(1000\)</span>, the filter ultimately fails to estimate the state in time.</div>
<div class="line">Unlike the linear Kalman filter, the performance of the extended Kalman filter is highly dependent on the initial conditions.</div>
</div>
<div class="line-block">
<div class="line">To address these sensitivities, we introduced a nonzero process noise in the coefficient variable of the process noise matrix (<span class="math notranslate nohighlight">\(Q\)</span>). This adjustment adds flexibility to the filter dynamics and improves robustness.</div>
<div class="line">The effect of this process noise can be observed in the following figure, where the estimated error (white lines) remains high and does not converge as a function of time.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawekf</span><span class="p">(</span><span class="n">trueobj</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">measures</span> <span class="o">=</span> <span class="n">altmtr</span><span class="p">,</span> <span class="n">ekf</span> <span class="o">=</span>  <span class="n">ekf</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Filtered&#39;</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">txtcaption</span> <span class="o">=</span> <span class="s2">&quot;Figure 7: Focus on an arbitrary part of the target altitude.</span><span class="se">\n</span><span class="s2">Magenta = true target, cyan = samples by nonideal radar, yellow = estimated target.&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/programs_ballistic_coefficient_71_0.png" src="../_images/programs_ballistic_coefficient_71_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Figure</span> <span class="pre">7</span></code> compares the actual error (the difference between the true target value — magenta — and the estimated target value — yellow) with the theoretical predictions of the covariance matrix (white).</p>
<p>Here, we see that the actual error agrees with the theoretical predictions; that is, the actual errors do not exceed the bounds predicted by the system covariance (<span class="math notranslate nohighlight">\(P\)</span>).</p>
<p>However, one drawback of the extended Kalman filter is the potential discrepancy between the actual errors and the covariance predictions.</p>
<div class="line-block">
<div class="line">This highlights a key limitation: the filter may not detect when it is failing.</div>
<div class="line">Thus, while the covariance matrix is essential for computing the Kalman gain, its theoretical predictions are not always reliable for assessing filter performance.</div>
</div>
</section>
</section>
</section>
<section id="Conclusion">
<h1>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading">#</a></h1>
<p>This notebook highlighted the successful estimation of the ballistic coefficient, a critical parameter in the target’s aerodynamics, using the Extended Kalman Filter (EKF).</p>
<p>The EKF’s implementation within the c4dynamics framework proved effective, leveraging its capabilities for flexible state management, system modeling, and process linearization.</p>
<p>The results emphasize the importance of a structured approach to filter design, particularly in understanding the underlying system dynamics and refining noise parameters.</p>
<p>A few steps to consider when designing a Kalman filter:</p>
<ul class="simple">
<li><p>Spend some time understanding the dynamics. It’s the basis of great filtering.</p></li>
<li><p>If the system is nonlinear, identify the nonlinearity; is it in the process? in the measurement? both?</p></li>
<li><p>Always prioriorotize linear Kalman. If possible, find a nominal trajectory to linearize the system about.</p></li>
<li><p>The major time-consuming activity is researching the balance between the noise matrices <span class="math notranslate nohighlight">\(Q\)</span> and <span class="math notranslate nohighlight">\(R\)</span> <span class="math notranslate nohighlight">\(→\)</span> Plan your time in advance.</p></li>
<li><p>Use a framework that provides you with the most flexibility and control.</p></li>
<li><p>Make fun!</p></li>
</ul>
</section>
<section id="References">
<h1>References<a class="headerlink" href="#References" title="Link to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">[1]</span></code> Zarchan, Paul, Tactical and Strategic Missile Guidance, American Institute of Aeronautics and Astronautics, 1981.</p>
<p><code class="docutils literal notranslate"><span class="pre">[2]</span></code> Simon, Dan, Optimal State Estimation: Kalman, H Infinity, and Nonlinear Approaches, Hoboken: Wiley, 2006.</p>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="dof6sim.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Proportional Navigation Guidance - 6 Degrees of Freedom Simulation</p>
      </div>
    </a>
    <a class="right-next"
       href="car_tracker.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Cars Tracker using Kalman Filter and Objects Detection Model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Ballistic Coefficient Estimation using Extended Kalman Filter</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Priliminary-Remarks">Priliminary Remarks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Extended-Kalman-Filter-(EKF)">Extended Kalman Filter (EKF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Dynamics-[1]">Dynamics <code class="docutils literal notranslate"><span class="pre">[1]</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1^{st}-Case:-Ideal-Radar"><span class="math notranslate nohighlight">\(1^{st}\)</span> Case: Ideal Radar</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Setup-&amp;-Initial-Conditions">Setup &amp; Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Main-Loop">Main Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Plotting">Plotting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2^{nd}-Case:-Noisy-Radar"><span class="math notranslate nohighlight">\(2^{nd}\)</span> Case: Noisy Radar</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Setup &amp; Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Main Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Results">Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3^{rd}-Case:-Filterring"><span class="math notranslate nohighlight">\(3^{rd}\)</span> Case: Filterring</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Initial-Conditions">Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#System-Matrices">System Matrices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Noise-Covariances-(Q,-R)">Noise Covariances (Q, R)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Main Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Conclusion">Conclusion</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#References">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By c4dynamics
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, c4dynamics.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Oct 13, 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>